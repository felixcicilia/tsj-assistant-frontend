<!-- src/app/usuarios/crear-usuarios/crear-usuarios.component.html -->

<div class="container py-3">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="mb-0">Crear usuario</h4>

    <a routerLink="/usuarios" class="btn btn-sm btn-outline-secondary">
      ← Volver al listado
    </a>
  </div>

  <div *ngIf="errorMsg" class="alert alert-danger">
    {{ errorMsg }}
  </div>

  <div class="card border-0 shadow-sm">
    <div class="card-body">
      <form [formGroup]="form" (ngSubmit)="onSubmit()">
        <div class="row g-3">
          <!-- Nombre -->
          <div class="col-md-6">
            <label class="form-label">Nombre</label>
            <input
              type="text"
              class="form-control"
              formControlName="name"
              placeholder="Nombre"
            />
            <div
              *ngIf="hasError('name', 'required')"
              class="text-danger small mt-1"
            >
              El nombre es obligatorio.
            </div>
          </div>

          <!-- Apellido -->
          <div class="col-md-6">
            <label class="form-label">Apellido</label>
            <input
              type="text"
              class="form-control"
              formControlName="lastName"
              placeholder="Apellido"
            />
          </div>

          <!-- Documento -->
          <div class="col-md-4">
            <label class="form-label">Cédula / Documento</label>
            <input
              type="text"
              class="form-control"
              formControlName="documentId"
              placeholder="V-12345678"
            />
          </div>

          <!-- Teléfono -->
          <div class="col-md-4">
            <label class="form-label">Teléfono</label>
            <input
              type="text"
              class="form-control"
              formControlName="phone"
              placeholder="+58..."
            />
          </div>

          <!-- Correo -->
          <div class="col-md-4">
            <label class="form-label">Correo electrónico</label>
            <input
              type="email"
              class="form-control"
              formControlName="email"
              placeholder="usuario@tsj.test"
            />
            <div
              *ngIf="hasError('email', 'required')"
              class="text-danger small mt-1"
            >
              El correo es obligatorio.
            </div>
            <div
              *ngIf="hasError('email', 'email')"
              class="text-danger small mt-1"
            >
              El formato del correo no es válido.
            </div>
          </div>

          <!-- Dirección -->
          <div class="col-12">
            <label class="form-label">Dirección</label>
            <input
              type="text"
              class="form-control"
              formControlName="address"
              placeholder="Dirección completa"
            />
          </div>

          <!-- Estado -->
          <div class="col-md-4">
            <label class="form-label">Estado / Provincia</label>
            <input
              type="text"
              class="form-control"
              formControlName="state"
              placeholder="Estado"
            />
          </div>

          <!-- País -->
          <div class="col-md-4">
            <label class="form-label">País</label>
            <input
              type="text"
              class="form-control"
              formControlName="country"
              placeholder="País"
            />
          </div>

          <!-- Rol -->
          <div class="col-md-4">
            <label class="form-label">Rol</label>
            <select class="form-select" formControlName="role">
              <option value="">Seleccione un rol…</option>
              <option *ngFor="let r of roles" [value]="r">
                {{ r }}
              </option>
            </select>
            <div
              *ngIf="hasError('role', 'required')"
              class="text-danger small mt-1"
            >
              El rol es obligatorio.
            </div>
          </div>

          <!-- Password -->
          <div class="col-md-6">
            <label class="form-label">Contraseña</label>
            <input
              type="password"
              class="form-control"
              formControlName="password"
              placeholder="Mínimo 6 caracteres"
            />
            <div
              *ngIf="hasError('password', 'required')"
              class="text-danger small mt-1"
            >
              La contraseña es obligatoria.
            </div>
            <div
              *ngIf="hasError('password', 'minlength')"
              class="text-danger small mt-1"
            >
              Debe tener al menos 6 caracteres.
            </div>
          </div>

          <!-- Confirm Password -->
          <div class="col-md-6">
            <label class="form-label">Confirmar contraseña</label>
            <input
              type="password"
              class="form-control"
              formControlName="confirmPassword"
              placeholder="Repita la contraseña"
            />
            <div
              *ngIf="hasError('confirmPassword', 'required')"
              class="text-danger small mt-1"
            >
              Confirme la contraseña.
            </div>
            <div
              *ngIf="hasError('confirmPassword', 'passwordMismatch')"
              class="text-danger small mt-1"
            >
              Las contraseñas no coinciden.
            </div>
          </div>
        </div>

        <div class="d-flex justify-content-end gap-2 mt-4">
          <button
            type="button"
            class="btn btn-outline-secondary"
            routerLink="/usuarios"
            [disabled]="saving"
          >
            Cancelar
          </button>

          <button
            type="submit"
            class="btn btn-success"
            [disabled]="saving || form.invalid"
          >
            <span
              class="spinner-border spinner-border-sm me-2"
              *ngIf="saving"
            ></span>
            Crear usuario
          </button>
        </div>
      </form>
    </div>
  </div>
</div>